import random
import asyncio
import logging
from aiogram import Bot, Dispatcher
from apscheduler.schedulers.asyncio import AsyncIOScheduler
from apscheduler.events import EVENT_JOB_ERROR

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –∏ ID –≥—Ä—É–ø–ø—ã
TOKEN = "8086402680:AAHXsLs0eZNuNOS8P4Hx9DpY_kOd_IZ26yc"
GROUP_CHAT_ID = -1002338597070

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞, –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∑–∞–¥–∞—á
bot = Bot(token=TOKEN)
dp = Dispatcher()
scheduler = AsyncIOScheduler()

# –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π
weekly_tasks = [
    "–°–µ–≥–æ–¥–Ω—è –∑–∞–¥–∞—á–∞ –ø—Ä–æ—Å—Ç–∞—è: –ø–æ—Ö–≤–∞–ª–∏ –∫–æ–≥–æ-—Ç–æ –∏–∑ –∫–æ–º–∞–Ω–¥—ã. –ù–µ –≤ –≥–æ–ª–æ–≤–µ. –í—Å–ª—É—Ö –∏–ª–∏ —Ç–µ–∫—Å—Ç–æ–º.",
    "–ü–æ–π–º–∞–π –º–æ–º–µ–Ω—Ç —Ç–∏—à–∏–Ω—ã –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏ –∏ –ø–æ–¥—É–º–∞–π: —á—Ç–æ —Å–µ–≥–æ–¥–Ω—è –ø–æ–ª—É—á–∏–ª–æ—Å—å —Ö–æ—Ä–æ—à–æ?",
    "–°–¥–µ–ª–∞–π —Ä–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ —á—É—Ç—å —É—é—Ç–Ω–µ–µ. –û–¥–∏–Ω –º–∞–ª–µ–Ω—å–∫–∏–π —à—Ç—Ä–∏—Ö.",
    "–û—Ç–ø—Ä–∞–≤—å –∫–æ–ª–ª–µ–≥–µ –º–µ–º, –∫–æ—Ç–æ—Ä—ã–π –∏–¥–µ–∞–ª—å–Ω–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç —ç—Ç—É –Ω–µ–¥–µ–ª—é.",
    "–ù–∞ 10 –º–∏–Ω—É—Ç –≤—ã–π–¥–∏ –∏–∑ —á–∞—Ç–æ–≤. –ú–∏—Ä –Ω–µ —Ä—É—Ö–Ω–µ—Ç, –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤–æ–ª–∫–∞–º–∏.",
    "–°–ø—Ä–æ—Å–∏ —É –∫–æ–ª–ª–µ–≥–∏, –∫–∞–∫ –æ–Ω –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ. –ò –≤—ã—Å–ª—É—à–∞–π.",
    "–í—Å–ø–æ–º–Ω–∏, –∑–∞—á–µ–º —Ç—ã –≤–æ–æ–±—â–µ —ç—Ç–∏–º –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è. –û—Ç–≤–µ—Ç –º–æ–∂–µ—à—å –æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∏ —Å–µ–±–µ.",
]

# –ó–∞–¥–∞—á–∞ –¥–ª—è –≤—Ç–æ—Ä–Ω–∏–∫–∞
async def send_tuesday_task():
    task = random.choice(weekly_tasks)
    text = (
        "üê∫ –í–æ–ª–∫ –Ω–∞ —Å–≤—è–∑–∏.\n\n"
        "–í—Ç–æ—Ä–Ω–∏–∫ ‚Äî –∑–Ω–∞—á–∏—Ç –≤—Ä–µ–º—è –º–∞–ª–µ–Ω—å–∫–æ–π –∑–∞–¥–∞—á–∏:\n\n"
        f"üëâ {task}\n\n"
        "–ë–µ–∑ –æ—Ç—á—ë—Ç–æ–≤. –ü—Ä–æ—Å—Ç–æ –ø–æ–ø—Ä–æ–±—É–π."
    )
    try:
        await bot.send_message(GROUP_CHAT_ID, text)
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É: {e}")

# –ó–∞–¥–∞—á–∞ –¥–ª—è –ø—è—Ç–Ω–∏—Ü—ã (–ú–∞–∫)
async def send_friday_mac():
    text = (
        "üê∫ –ü—è—Ç–Ω–∏—Ü–∞. –£—Ç—Ä–æ.\n\n"
        "–í–æ–ª–∫ –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç:\n"
        "–ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã –Ω–∞–¥–æ –∑–∞–µ—Ö–∞—Ç—å –≤ –º–∞–∫ üçî\n\n"
        "–†–∞–±–æ—Ç–∞ –ø–æ–¥–æ–∂–¥—ë—Ç. –ö–∞—Ä—Ç–æ—à–∫–∞ ‚Äî –Ω–µ—Ç."
    )
    try:
        await bot.send_message(GROUP_CHAT_ID, text)
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É: {e}")

# –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
scheduler.add_job(send_tuesday_task, "cron", day_of_week="tue", hour=11, minute=0)
scheduler.add_job(send_friday_mac, "cron", day_of_week="fri", hour=10, minute=0)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã - –ß—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –º–æ–∂–µ—à—å –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å cron-—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –±–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª: scheduler.add_job(send_tuesday_task, "interval", minutes=1) scheduler.add_job(send_thursday_task, "interval", minutes=1)
# –ü—Ä–æ–≤–µ—Ä—å, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ. –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –≤–µ—Ä–Ω–∏ –æ–±—Ä–∞—Ç–Ω–æ cron: scheduler.add_job(send_tuesday_task, "cron", day_of_week="tue", hour=11, minute=0)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
def job_error_listener(event):
    if event.exception:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏: {event.job_id}")

scheduler.add_listener(job_error_listener, EVENT_JOB_ERROR)

# –û—Å–Ω–æ–≤–Ω–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
async def main():
    scheduler.start()  # –ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
    await dp.start_polling(bot)  # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
if __name__ == "__main__":
    asyncio.run(main())





